# One of 'breaking', 'deprecation', 'new_component', 'enhancement', 'bug_fix'
change_type: enhancement

# The name of the component, or a single word describing the area of concern, (e.g. tempostack, tempomonolithic, github action)
component: networking

# A brief description of the change. Surround your text with quotes ("") if it needs to start with a backtick (`).
note: "Add network policy support for Tempo operands"

# One or more tracking issues related to the change
issues: [1246]

# (Optional) One or more lines of additional information to render under the primary note.
# These lines will be padded with 2 spaces and then inserted directly into the document.
# Use pipe (|) for multiline entries.
subtext: |
  Network policies are now **enabled by default** for all TempoStacks.

  ## Enabling/Disabling Network Policies

  Network policies are enabled by default. To disable them:

  ```yaml
  apiVersion: tempo.grafana.com/v1alpha1
  kind: TempoStack
  metadata:
    name: example
  spec:
    networkPolicy:
      enabled: false  # Default is true
  ```

  ## Generated Network Policies

  The operator creates the following network policies for each component:

  ### Query-Frontend
  **Egress (outbound connections):**
  - Storage backend (S3/Azure/GCS) - Required for initialization
  - Queriers (ports 9095, 3200) - For query distribution
  - OTLP telemetry export (when configured)

  **Ingress (inbound connections):**
  - From cluster (port 9095, 3200) - External query access
  - From gateway (when enabled) - For proxied queries
  - From queriers (ports 9095, 3200) - Bidirectional worker communication

  ### Gateway (when enabled)
  **Egress (outbound connections):**
  - Distributor (ports 4317, 4318) - For ingesting traces via OTLP
  - Query-frontend (ports 9095, 3200) - For querying traces
  - Query-frontend (ports 16686, 16687) - For Jaeger Query UI and metrics (when JaegerQuery is enabled)
  - Kubernetes API server (port 6443) - For TokenReview/SubjectAccessReview (when OpenShift RBAC multi-tenancy is enabled)
  - OTLP telemetry export (when configured)

  **Ingress (inbound connections):**
  - From cluster (ports 8080, 8090) - External HTTP/gRPC access for trace ingestion and queries

  ### Ingester
  **Egress (outbound connections):**
  - Storage backend (S3/Azure/GCS) - For writing trace blocks
  - OTLP telemetry export (when configured)

  **Ingress (inbound connections):**
  - From distributor (ports 9095, 3200) - For receiving traces
  - From querier (ports 9095, 3200) - For querying recent traces

  ### Storage Backend Support
  - **S3 (in-cluster)**: Port extracted from endpoint URL, defaults to 443 (HTTPS) or 80 (HTTP). Allows egress to any namespace/pod for services like MinIO.
  - **Azure Storage**: Port 443 (HTTPS). Allows egress to external internet (0.0.0.0/0) for Azure Storage endpoints.
  - **Google Cloud Storage (GCS)**: Port 443 (HTTPS). Allows egress to external internet (0.0.0.0/0) for GCS and OAuth2 endpoints (storage.googleapis.com, oauth2.googleapis.com).

  ### Common Policies
  All components also have:
  - DNS egress (to kube-dns or openshift-dns)
  - Gossip ring communication (memberlist protocol)
  - Metrics ingress (port 3200) - For Prometheus/monitoring scraping from in-cluster monitoring namespaces
