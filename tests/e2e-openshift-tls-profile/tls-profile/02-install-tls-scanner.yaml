apiVersion: v1
kind: ServiceAccount
metadata:
  name: tls-scanner
  namespace: chainsaw-tls-profile-gw
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: tls-scanner-pods-reader-tls-profile-gw
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: tls-scanner-pods-reader-tls-profile-gw
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: tls-scanner-pods-reader-tls-profile-gw
subjects:
- kind: ServiceAccount
  name: tls-scanner
  namespace: chainsaw-tls-profile-gw
---
apiVersion: security.openshift.io/v1
kind: SecurityContextConstraints
metadata:
  name: tls-scanner-scc-tls-profile-gw
allowPrivilegedContainer: true
allowPrivilegeEscalation: true
allowHostNetwork: false
allowHostPorts: false
runAsUser:
  type: RunAsAny
seLinuxContext:
  type: RunAsAny
seccompProfiles:
- '*'
users:
- system:serviceaccount:chainsaw-tls-profile-gw:tls-scanner
---
apiVersion: v1
kind: Pod
metadata:
  name: tls-scanner
  namespace: chainsaw-tls-profile-gw
  labels:
    app: tls-scanner
spec:
  serviceAccountName: tls-scanner
  containers:
  - name: tls-scanner
    image: quay.io/rhn_support_ikanse/tls-scanner:latest
    command: ["sleep", "infinity"]
    securityContext:
      privileged: true
      runAsUser: 0
  restartPolicy: Never
