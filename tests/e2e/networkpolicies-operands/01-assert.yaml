---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tempo-simplest-compactor
status:
  readyReplicas: 1
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tempo-simplest-distributor
status:
  readyReplicas: 1
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: tempo-simplest-ingester
status:
  readyReplicas: 1
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tempo-simplest-querier
status:
  readyReplicas: 1
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tempo-simplest-query-frontend
status:
  readyReplicas: 1
---
# DNS policy assertion removed - handled by script in chainsaw-test.yaml
# because policy name differs between Kubernetes (tempo-simplest-allow-dns)
# and OpenShift (tempo-simplest-allow-dns-openshift)
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  labels:
    app.kubernetes.io/component: compactor
    app.kubernetes.io/instance: simplest
    app.kubernetes.io/managed-by: tempo-operator
    app.kubernetes.io/name: tempo
  name: tempo-simplest-compactor
spec:
  egress:
  # Storage egress doesn't specify ports because kube-proxy DNATs ClusterIP
  # service traffic to targetPort, which may differ from service port
  - to:
    - ipBlock:
        cidr: 0.0.0.0/0
    - namespaceSelector: {}
  podSelector:
    matchLabels:
      app.kubernetes.io/component: compactor
      app.kubernetes.io/instance: simplest
      app.kubernetes.io/managed-by: tempo-operator
      app.kubernetes.io/name: tempo
  policyTypes:
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  labels:
    app.kubernetes.io/component: distributor
    app.kubernetes.io/instance: simplest
    app.kubernetes.io/managed-by: tempo-operator
    app.kubernetes.io/name: tempo
  name: tempo-simplest-distributor
spec:
  egress:
  - ports:
    - port: 9095
      protocol: TCP
    to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: ingester
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
  - ports:
    - port: 3200
      protocol: TCP
    to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: ingester
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
  ingress:
  - from:
    - namespaceSelector: {}
    ports:
    - port: 4317
      protocol: TCP
    - port: 4318
      protocol: TCP
    - port: 14268
      protocol: TCP
    - port: 6831
      protocol: UDP
    - port: 6832
      protocol: UDP
    - port: 14250
      protocol: TCP
    - port: 9411
      protocol: TCP
    - port: 3200
      protocol: TCP
  podSelector:
    matchLabels:
      app.kubernetes.io/component: distributor
      app.kubernetes.io/instance: simplest
      app.kubernetes.io/managed-by: tempo-operator
      app.kubernetes.io/name: tempo
  policyTypes:
  - Egress
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  labels:
    app.kubernetes.io/instance: simplest
    app.kubernetes.io/managed-by: tempo-operator
  name: tempo-simplest-gossip
spec:
  egress:
  - ports:
    - port: 7946
      protocol: TCP
    - port: 3200
      protocol: TCP
    - port: 3101
      protocol: TCP
    to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
    ports:
    - port: 7946
      protocol: TCP
    - port: 3200
      protocol: TCP
    - port: 3101
      protocol: TCP
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: simplest
      app.kubernetes.io/managed-by: tempo-operator
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  labels:
    app.kubernetes.io/component: ingester
    app.kubernetes.io/instance: simplest
    app.kubernetes.io/managed-by: tempo-operator
    app.kubernetes.io/name: tempo
  name: tempo-simplest-ingester
spec:
  egress:
  # Storage egress doesn't specify ports because kube-proxy DNATs ClusterIP
  # service traffic to targetPort, which may differ from service port
  - to:
    - ipBlock:
        cidr: 0.0.0.0/0
    - namespaceSelector: {}
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: distributor
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
    ports:
    - port: 9095
      protocol: TCP
    - port: 3200
      protocol: TCP
  - from:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: querier
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
    ports:
    - port: 9095
      protocol: TCP
    - port: 3200
      protocol: TCP
  podSelector:
    matchLabels:
      app.kubernetes.io/component: ingester
      app.kubernetes.io/instance: simplest
      app.kubernetes.io/managed-by: tempo-operator
      app.kubernetes.io/name: tempo
  policyTypes:
  - Egress
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  labels:
    app.kubernetes.io/component: querier
    app.kubernetes.io/instance: simplest
    app.kubernetes.io/managed-by: tempo-operator
    app.kubernetes.io/name: tempo
  name: tempo-simplest-querier
spec:
  egress:
  - ports:
    - port: 9095
      protocol: TCP
    to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: ingester
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
  - ports:
    - port: 3200
      protocol: TCP
    to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: ingester
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
  - ports:
    - port: 9095
      protocol: TCP
    to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: query-frontend
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
  - ports:
    - port: 3200
      protocol: TCP
    to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: query-frontend
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
  # Storage egress doesn't specify ports because kube-proxy DNATs ClusterIP
  # service traffic to targetPort, which may differ from service port
  - to:
    - ipBlock:
        cidr: 0.0.0.0/0
    - namespaceSelector: {}
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: query-frontend
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
    ports:
    - port: 9095
      protocol: TCP
    - port: 3200
      protocol: TCP
  podSelector:
    matchLabels:
      app.kubernetes.io/component: querier
      app.kubernetes.io/instance: simplest
      app.kubernetes.io/managed-by: tempo-operator
      app.kubernetes.io/name: tempo
  policyTypes:
  - Egress
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  labels:
    app.kubernetes.io/component: query-frontend
    app.kubernetes.io/instance: simplest
    app.kubernetes.io/managed-by: tempo-operator
    app.kubernetes.io/name: tempo
  name: tempo-simplest-query-frontend
spec:
  egress:
  - ports:
    - port: 9095
      protocol: TCP
    to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: querier
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
  - ports:
    - port: 3200
      protocol: TCP
    to:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: querier
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
  # Storage egress doesn't specify ports because kube-proxy DNATs ClusterIP
  # service traffic to targetPort, which may differ from service port
  - to:
    - ipBlock:
        cidr: 0.0.0.0/0
    - namespaceSelector: {}
  ingress:
  - from:
    - namespaceSelector: {}
    ports:
    - port: 9095
      protocol: TCP
    - port: 3200
      protocol: TCP
    - port: 16686
      protocol: TCP
    - port: 16687
      protocol: TCP
  - from:
    - podSelector:
        matchLabels:
          app.kubernetes.io/component: querier
          app.kubernetes.io/instance: simplest
          app.kubernetes.io/managed-by: tempo-operator
          app.kubernetes.io/name: tempo
    ports:
    - port: 9095
      protocol: TCP
    - port: 3200
      protocol: TCP
  podSelector:
    matchLabels:
      app.kubernetes.io/component: query-frontend
      app.kubernetes.io/instance: simplest
      app.kubernetes.io/managed-by: tempo-operator
      app.kubernetes.io/name: tempo
  policyTypes:
  - Egress
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  labels:
    app.kubernetes.io/instance: simplest
    app.kubernetes.io/managed-by: tempo-operator
  name: tempo-simplest-ingress-to-operand-metrics
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: openshift.io/cluster-monitoring
          operator: Exists
    ports:
    - port: 3200
      protocol: TCP
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: simplest
      app.kubernetes.io/managed-by: tempo-operator
  policyTypes:
  - Ingress
